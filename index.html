<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js webgl - cloth simulation</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				font-family: Monospace;
				background-color: #000;
				color: #000;
				margin: 0px;
				overflow: hidden;
			}

			#info {
				position: absolute;
				padding: 10px;
				width: 100%;
				text-align: center;
			}

			a {
				text-decoration: underline;
				cursor: pointer;
			}

		</style>
	</head>

	<body>
		<div id="info">Jello Simulation<br/>
			holy fk javascript is op<br/>
		</div>

		<script src="js/three.js"></script>

		<script src="js/WebGL.js"></script>
		<script src="js/OrbitControls.js"></script>

		<script src="js/Cloth.js"></script>

		<script>
			// HI TIFFANY / ASHLEY U GUYS SHOULD EDIT THESE
			function vertexShader() {
			return `
				varying vec3 vUv; 

				void main() {
				vUv = position; 

				vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);
				gl_Position = projectionMatrix * modelViewPosition; 
				}
			`
			}
			function fragmentShader() {
				return `
					uniform vec3 colorA; 
					uniform vec3 colorB; 
					varying vec3 vUv;

					void main() {
						gl_FragColor = vec4(mix(colorA, colorB, vUv.z), 1.0);
					}
				`
			}
		

			if ( WEBGL.isWebGLAvailable() === false ) {

				document.body.appendChild( WEBGL.getWebGLErrorMessage() );

			}

			var container;
			var camera, scene, renderer;

			var clothGeometry;
			var sphere;
			var object;

			init();
			animate();

			function init() {

				container = document.createElement( 'div' );
				document.body.appendChild( container );

				// scene

				scene = new THREE.Scene();
				scene.background = new THREE.Color( 0xcce0ff );
				// scene.fog = new THREE.Fog( 0xcce0ff, 500, 10000 );

				// camera

				camera = new THREE.PerspectiveCamera( 30, window.innerWidth / window.innerHeight, 1, 10000 );
				camera.position.set( 0, 50, 50 );

				// lights

				scene.add( new THREE.AmbientLight( 0x666666 ) );

				var light = new THREE.DirectionalLight( 0xdfebff, 0.5 );
				light.position.set( 50, 200, 100 );
				light.castShadow = true;

				light.shadow.mapSize.width = 1024;
				light.shadow.mapSize.height = 1024;

				scene.add( light );

				// cloth geometry

				clothGeometry = new THREE.BoxGeometry(cloth.w, cloth.h, cloth.d, 2, 2, 2);
				
				let uniforms = {
					colorB: {type: 'vec3', value: new THREE.Color(0xACB6E5)},
					colorA: {type: 'vec3', value: new THREE.Color(0x74ebd5)}
				}
				let material =  new THREE.ShaderMaterial({
					uniforms: uniforms,
					fragmentShader: fragmentShader(),
					vertexShader: vertexShader(),
				})

				// var wireframe = new THREE.WireframeGeometry(clothGeometry);
				// var line = new THREE.LineSegments(wireframe);
				// line.material.depthTest = false;
				// line.material.opacity = 0.25;
				// line.material.transparent = true;
				// scene.add(line);
				// cloth mesh

				object = new THREE.Mesh( clothGeometry, material);
				object.position.set( 0, 0, 0 );
				object.castShadow = true;
				scene.add( object );

			
				// ground

				var groundMaterial = new THREE.MeshLambertMaterial();

				var mesh = new THREE.Mesh( new THREE.PlaneBufferGeometry( 1000, 1000 ), groundMaterial );
				mesh.position.y = - 20;
				mesh.rotation.x = - Math.PI / 2;
				mesh.receiveShadow = true;
				scene.add( mesh );

			
				// renderer

				renderer = new THREE.WebGLRenderer( { antialias: true } );
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );

				container.appendChild( renderer.domElement );

				renderer.gammaInput = true;
				renderer.gammaOutput = true;

				renderer.shadowMap.enabled = true;

				// controls
				var controls = new THREE.OrbitControls( camera, renderer.domElement );
				controls.maxPolarAngle = Math.PI * 0.5;
				controls.minDistance = 5;
				controls.maxDistance = 5000;

				window.addEventListener( 'resize', onWindowResize, false );
			}

			function onWindowResize() {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}


			function animate() {

				requestAnimationFrame( animate );

				var time = Date.now();
				// simulate( time );
				render();

			}

			function render() {

				// do verlet integration

				// var p = cloth.particles;
				// for ( var i = 0, il = p.length; i < il; i ++ ) {
				// 	var v = p[ i ].position;
				// 	clothGeometry.attributes.position.setXYZ( i, v.x, v.y, v.z );
				// }
				// clothGeometry.attributes.position.needsUpdate = true;
				// clothGeometry.computeVertexNormals();
				// for (var i = 0; i < clothGeometry.vertices.length; i++) {
				// 	clothGeometry.vertices[i].setX(clothGeometry.vertices[i].x + 1);
				// 	clothGeometry.vertices[i].setY(clothGeometry.vertices[i].y + 1);
				// 	clothGeometry.vertices[i].setZ(clothGeometry.vertices[i].z + 1);
				// }
				// clothGeometry.verticesNeedUpdate = true;
				renderer.render( scene, camera );
			}

		</script>
	</body>
</html>